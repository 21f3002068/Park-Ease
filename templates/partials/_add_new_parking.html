<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ParkEase</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style/partials/_add_new_parking.css') }}">

    <!-- Inline style using Jinja2 syntax -->
    <style>
        body,
        html {
            height: 100%;
            margin: 0;
            padding: 0;
            position: relative;
            /* overflow: hidden; */
        }

        .background-blur {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("{{ url_for('static', filename='image/parkease bg.png') }}") no-repeat center center / cover;
            filter: blur(8px);
            z-index: -1;
        }

        .content {
            position: relative;
            z-index: 1;
            color: white;
            text-align: center;
            padding-top: 100px;
        }
    </style>
</head>

<body>

    <div class="background-blur"></div>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <ul class="flash-messages">
        {% for category, message in messages %}
        <li class="flash {{ category }}">{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    {% endwith %}
    <div class="content">
        <div class="form-container">
            <div class="form-content">
                <h2>Add New Parking Lot</h2>
                <form action="{{ url_for('admin.add_parking_lot') }}" method="POST" onsubmit="return validateSpots()">
                    <!-- Prime Location Name -->
                    <div class="form-group">
                        <label for="prime_location_name">Parking Name</label>
                        <input type="text" id="prime_location_name" name="prime_location_name" required>
                    </div>

                    <!-- Location Select Dropdown -->
                    <div class="form-group">
                        <label for="location_id">Location</label>
                        <select name="location_id" id="location_id" required>
                            {% for location in locations %}
                            <option value="{{ location.id }}" {% if selected_location_id and
                                location.id==selected_location_id %} selected {% endif %}>
                                {{ location.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Parking Limit -->
                    <div class="form-group">
                        <label for="max_parking_spots">Parking Limit: </label>
                        <input type="number" id="max_parking_spots" name="max_parking_spots" min="1"
                            placeholder="e.g., 100" required>
                    </div>

                    <!-- Number of Available Spots -->
                    <div class="form-group">
                        <label for="available_spots">Available Spots</label>
                        <input type="number" id="available_spots" name="available_spots" min="0" placeholder="e.g., 50"
                            required> 
                    </div>

                    <!-- Price per Hour -->
                    <div class="form-group">
                        <label for="price_per_hour">Price per Hour</label>
                        <input type="number" id="price_per_hour" name="price_per_hour" step="0.01" min="0" required>
                    </div>

                    <!-- Available From (Time) -->
                    <div class="form-group">
                        <label for="available_from">Available From</label>
                        <input type="time" id="available_from" name="available_from" required>
                    </div>

                    <!-- Available To (Time) -->
                    <div class="form-group">
                        <label for="available_to">Available To</label>
                        <input type="time" id="available_to" name="available_to" required>
                    </div>

                    <!-- Active Status -->
                    <div class="form-group">
                        <label for="is_active">Is Active?</label>
                        <select id="is_active" name="is_active">
                            <option value="true" selected>Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>

                    <div class="button-group">
                        <a href="{{ url_for('admin.admin_dashboard') }}" class="cancel-btn">Cancel</a>
                        <button type="submit" class="submit-btn">Add Parking Lot</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <script>
        function validateSpots() {
            const maxSpots = parseInt(document.getElementById('max_parking_spots').value);
            const availableSpots = parseInt(document.getElementById('available_spots').value);

            if (isNaN(maxSpots) || maxSpots <= 0) {
                alert("Please enter a valid parking limit (minimum 1)");
                return false;
            }

            if (isNaN(availableSpots) || availableSpots < 0) {
                alert("Please enter a valid number of available spots");
                return false;
            }

            if (availableSpots > maxSpots) {
                alert(`Available spots (${availableSpots}) cannot exceed parking limit (${maxSpots})`);
                return false;
            }
            return true;
        }



        document.addEventListener('DOMContentLoaded', function () {
            // Set initial max value for available spots
            const maxInput = document.getElementById('max_parking_spots');
            const availableInput = document.getElementById('available_spots');
            if (maxInput.value) {
                availableInput.max = maxInput.value;
            }

            // Add the change event listener
            maxInput.addEventListener('input', function () {
                const maxSpots = parseInt(this.value) || 1;
                availableInput.max = maxSpots;
                if (parseInt(availableInput.value) > maxSpots) {
                    availableInput.value = maxSpots;
                }
            });
        });



        function validateTimes() {
            const fromTime = document.getElementById('available_from').value;
            const toTime = document.getElementById('available_to').value;

            if (fromTime && toTime && fromTime >= toTime) {
                alert("Closing time must be after opening time");
                return false;
            }
            return true;
        }

        // Update your form onsubmit:
        onsubmit = "return validateSpots() && validateTimes()"




        function validatePrice() {
            const price = parseFloat(document.getElementById('price_per_hour').value);
            if (isNaN(price) || price <= 0) {
                alert("Please enter a valid price per hour");
                return false;
            }
            return true;
        }

        // Update your form onsubmit:
        onsubmit = "return validateSpots() && validateTimes() && validatePrice()"
    </script>
</body>

</html>