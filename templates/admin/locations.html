{% extends 'admin/adash_base.html' %}


{% block title %}Parking Locations{% endblock %}

{% block custom_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='/style/admin/locations.css') }}">
{% endblock%}

{% block body %}
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul class="flash-messages">
    {% for category, message in messages %}
    <li class="flash {{ category }}">{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}
{% endwith %}
{% block content %}

<div class="locations-wrapper">
    {% for item in location_data %}
    <div class="location-section">
        <div class="location-header">
            <h2>
                <ion-icon name="business-outline"></ion-icon>
                {{ item.location.name }}
            </h2>
            <a href="{{ url_for('admin.add_new_parking') }}?location_id={{ item.location.id }}" class="add-parking-btn">
                + Add a Parking
            </a>
        </div>


        <p class="location-address">
            <ion-icon name="location-outline"></ion-icon>
            {{ item.location.address }}, {{ item.location.pin_code }} | Total Available Parking Spots: {{ item.total_available_spots }}
        </p>


        <div class="lot-cards">
            {% for lot in item.lots %}
            <div class="lot-card">
                <!-- Status indicator and main content container -->
                <div class="lot-content">
                    <div class="status-indicator">
                        <div class="status-dot {% if lot.is_active %}active{% else %}inactive{% endif %}"></div>
                        <span class="status-text">{% if lot.is_active %}Available{% else %}Closed{% endif %}</span>
                    </div>

                    <div class="lot-details">
                        <h3 class="lot-title">{{ lot.prime_location_name }}</h3>

                        <div class="detail-grid">
                            <div class="detail-item">
                                <ion-icon name="pricetag-outline" class="detail-icon"></ion-icon>
                                <span class="detail-label">Price:</span>
                                <span class="detail-value">â‚¹{{ lot.price_per_hour }}/hr</span>
                            </div>

                            <div class="detail-item">
                                <ion-icon name="car-sport-outline" class="detail-icon"></ion-icon>
                                <span class="detail-label">Spots:</span>
                                <span class="detail-value">{{ lot.available_spots }}</span>
                            </div>

                            <div class="detail-item">
                                <ion-icon name="time-outline" class="detail-icon"></ion-icon>
                                <span class="detail-label">Hours:</span>
                                <span class="detail-value">
                                    {{ lot.available_from.strftime('%I:%M %p') }} - {{ lot.available_to.strftime('%I:%M
                                    %p') }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action buttons -->
                <div class="card-actions">
                    <a href="{{ url_for('admin.edit_parking', lot_id=lot.id) }}" class="action-btn edit-btn"
                        title="Edit">
                        <ion-icon name="create-outline"></ion-icon>
                        <span class="btn-tooltip">Edit</span>
                    </a>

                    <form action="{{ url_for('admin.delete_parking', lot_id=lot.id) }}" method="POST"
                        class="delete-form">
                        <button type="submit" class="action-btn delete-btn" title="Delete"
                            onclick="return confirm('Are you sure you want to delete this parking lot?');">
                            <ion-icon name="trash-outline"></ion-icon>
                            <span class="btn-tooltip">Delete</span>
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>


<a href="{{ url_for('admin.add_location') }}" class="add-location-btn">
    + Add New Location
</a>


<script>
    // Wait for the page to load
    window.addEventListener('DOMContentLoaded', () => {
      // Find all flash messages
      const flashMessages = document.querySelectorAll('.flash');
  
      // Set a timeout to remove them after 5 seconds (5000 ms)
      setTimeout(() => {
        flashMessages.forEach(msg => {
          msg.style.transition = 'opacity 0.5s ease';
          msg.style.opacity = '0';
          setTimeout(() => msg.remove(), 500); // Fully remove after fade out
        });
      }, 5000);
    });
  </script>
  

{% endblock %}
{% endblock %}