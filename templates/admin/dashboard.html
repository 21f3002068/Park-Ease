{% extends 'admin/adash_base.html' %}


{% block title %}Admin Dashboard{% endblock %}

{% block custom_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='/style/admin/admin_dashboard.css') }}">
{% endblock%}


{% block body %}
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul class="flash-messages">
    {% for category, message in messages %}
    <li class="flash {{ category }}">{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}
{% endwith %}
{% block content %}


<div class="parking-dashboard">
    {% set sorted_parking_lots = parking_lots | sort(attribute='occupied_spots', reverse=True) %}

    {% for lot in parking_lots %}
    {% set occupied_spots = false %}
    {% for spot in lot.spots %}
    {% if not occupied_spots and spot.status != 'A' %}
    {% set occupied_spots = true %}
    {% endif %}
    {% endfor %}

    <div class="parking-card">
        <div class="card-header">
            <h3>{{ lot.prime_location_name }}</h3>
            <div class="dropdown">
                <button class="three-dots">â‹®</button>
                <div class="dropdown-menu">
                    <a href="{{ url_for('admin.edit_parking', lot_id=lot.id) }}">Edit</a>

                    {% if not occupied_spots %}
                    <form action="{{ url_for('admin.delete_parking', lot_id=lot.id) }}" method="POST"
                        style="display: inline;"
                        onsubmit="return confirm('Are you sure you want to delete this parking lot?');">
                        <button type="submit" class="dropdown-item delete-btn">Delete</button>
                    </form>
                    {% else %}
                    <button class="dropdown-item delete-btn" disabled
                        title="Cannot delete: Some spots are occupied">Delete</button>
                    {% endif %}
                </div>
            </div>
        </div>

        <p class="slot-info">{{ lot.occupied_spots or 0 }} / {{ lot.available_spots }} slots occupied</p>

        <div class="slot-boxes">
            {% for spot in lot.spots %}
            <a href="{{ url_for('admin.view_spot', lot_id=lot.id, spot_number=spot.spot_number) }}"
                class="slot-box 
                {% if spot.status == 'O' %}
                    occupied
                {% elif spot.status == 'B' %}
                    booked
                {% endif %}" 
                title="Spot {{ spot.spot_number }}">
            </a>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>


<a href="{{ url_for('admin.add_new_parking') }}" class="add-parking-btn">
    + Add New Parking Lot
</a>



{% endblock %}
{% endblock %}